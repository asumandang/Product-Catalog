<ion-header>
  <ion-toolbar>
    <ion-title> Products </ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar
      [debounce]="debounceTime"
      (ionInput)="searchProduct($event)"
      (ionClear)="resetSearch()"
    ></ion-searchbar>
    <ion-progress-bar
      *rxIf="isLoading$"
      type="indeterminate"
    ></ion-progress-bar>
  </ion-toolbar>
</ion-header>

<ion-content *rxLet="action$; let action">
  @switch (action) { @case('pending') {
  <ng-container *ngTemplateOutlet="loading"> </ng-container>
  } @case('error') {
  <ng-container *ngTemplateOutlet="error"> </ng-container>
  } @case('done') {
  <ng-container *ngTemplateOutlet="products"> </ng-container>
  } }
</ion-content>

<!-- Template For Displaying Products -->
<ng-template #products>
  <ion-list *rxLet="product$; let products">
    @for(product of products; track product.id; let index = $index) {
    <ion-item>
      <pc-product-card
        [product]="product"
        [isPriority]="index < 5"
      ></pc-product-card>
    </ion-item>
    } @empty {
    <ion-item>No Products Found</ion-item>
    }
  </ion-list>
</ng-template>

<!-- Template When Loading -->
<ng-template #loading>
  <ion-list>
    @for(x of [1,2]; track x;) {
    <ion-item>
      <pc-product-card [product]="null"></pc-product-card>
    </ion-item>
    }
  </ion-list>
</ng-template>

<!-- Template For Error -->
<ng-template #error>
  <ion-text *rxLet="error$; let error"
    ><p class="error-text">{{error}}</p></ion-text
  >
  <ion-toast
    *rxLet="error$; let error"
    [isOpen]="!!error"
    [message]="error"
    [duration]="5000"
    position="top"
    color="danger"
  ></ion-toast>
</ng-template>
